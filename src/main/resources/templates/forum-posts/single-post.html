<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Single-post</title>
    <th:block th:include="partials/header.html :: styling"></th:block>

</head>
<body>
<nav th:replace="partials/navbar :: navbar"></nav>
<div class="container">
    <!-- post -->
    <div class="row">
        <!--        This is for up and down votes IF we plan on integrating this function.-->

        <!--        <div class="col-1">-->
        <!--            <div><a href="#" class="upvote"><i class="fas fa-arrow-up"></i></a></div>-->
        <!--            <div><span class="votecount">3</span></div>-->
        <!--            <div><a href="#" class="downvote"><i class="fas fa-arrow-down"></i></a></div>-->
        <!--        </div>-->

        <div class="col-11">
            <p class="title">
                <a class="title " th:text="${singleForumPost.title}" target="_blank">
                </a>
            </p>
            <img th:src="${singleForumPost.contentImageUrl}" alt="image" height="300" width="300">
            <p th:text="${singleForumPost.description}">Content:</p>
            <p>submitted on
                <time th:title="${singleForumPost.getCreatedDate()}" th:datetime="${singleForumPost.getCreatedDate()}"
                      th:text="${singleForumPost.getCreatedDate()}"></time>
                by
                <a th:href="@{'/profile/' + ${singleForumPost.getUser().getId()}}" class="author"
                   th:text="${singleForumPost.getUser().getUsername()}"></a>
            </p>
            <p>
                <a class="comments" th:text="|${singleForumPost.getComments().size()} comments|"><i
                        class="fas  fa-comments-o"></i> 0 comments</a>
            </p>
        </div>
    </div>

    <!-- Forum Post comments -->
    <div id="comments" class="comment_block">
        <div class="row header">
            <div class="col-1"></div>
            <div class="col-11 title" th:text="|all ${singleForumPost.getComments().size()} comments|"></div>
        </div>
        <!--        ADD COMMENT-->
        <div class="row" sec:authorize="!isAuthenticated()">
            <div class="col-1">&nbsp;</div>
            <div class="col-11">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Log in or sign up to leave a comment" readonly>
                    <div class="input-group-append">
                        <form th:action="@{/login}"
                              th:method="Get">
                            <button type="submit" class="btn btn-outline-primary">Log In</button>
                            <button th:formaction="@{/register}" type="submit" class="btn btn-outline-primary">Sign up</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" sec:authorize="isAuthenticated()">
            <div class="col-1">&nbsp;</div>
            <div class="col-11">
                <form method="POST"
                      th:action="@{/forum-posts/{id}/comment (id=${singleForumPost.id})}" th:object="${comment}">
                    <input type="hidden" th:field="*{post}"/>
                    <div class="form-group">
                        <textarea class="form-control" id="comment" rows="3" style="resize: none;"
                                  th:field="*{content}"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Comment</button>
                </form>
            </div>
        </div>
        <hr>
        <!-- single comment -->
        <div class="row" th:each="comment : ${singleForumPost.getComments()}">
            <div class="col-1">&nbsp;</div>
            <div class="col-11">
                <span><a th:href="@{'/profile/' + ${comment.getUser().getId()}}"
                         th:text="${comment.getUser().getUsername()}"><i class="far fa-user"></i></a></span>
                <span th:text="${comment.getCreateDate()}"><i class="far fa-clock"></i></span>
                <p class="body" th:text="${comment.getContent()}"></p>
                <a href="#" class="like"><i class="far fa-thumbs-up"></i> Like</a>
                <div class="row" sec:authorize="isAuthenticated()"
                     th:if="${#authentication.principal.id == comment.getUser().id}">
                    <span class="col">
                        <form th:action="@{/forum-posts/{id}/comment/{commentId}/edit(id=${singleForumPost.id},commentId=${comment.id})}"
                              th:method="Get">
                            <button type="submit" name="id" class="btn btn-secondary edit-btn"><i
                                    class="fas fa-edit"></i></button>
                        </form>
                    </span>
                    <span class="col">
                        <form th:action="@{/forum-posts/{id}/comment/{commentId}/delete(id=${singleForumPost.id},commentId=${comment.id})}"
                              th:method="Post">
                            <button type="submit" name="id" class="btn btn-danger delete-btn"><i
                                    class="fas fa-trash-alt"></i></button>
                        </form>
                    </span>
                </div>
            </div>
        </div>
    </div>

</div>
<th:block th:include="partials/footer.html :: scripts"></th:block>

</body>
</html>